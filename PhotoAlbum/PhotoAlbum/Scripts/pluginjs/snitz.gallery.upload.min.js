function isImage(n){var t=n.name,i=n.type,r=t.substring(t.lastIndexOf(".")+1).toLowerCase(),u=SnitzVars.allowedimagetypes.split(",");return i.indexOf("image")>=0?jQuery.inArray(r,u)==-1?!1:!0:!1}$(window).on("load",function(){$("body").on("click","#albumUpload",function(){var u,f,n,i;if(typeof galleryDropzone!="undefined")return!1;u="[image=";f="]";$.validator.unobtrusive.parse($("#galleryUploadForm"));var e=new FormData($("#galleryUploadForm").get(0)),t=document.getElementById("ImageFile"),r={};if(t!=null){for(n=0;n<t.files.length;n++){if(isImage(t.files[n]))e.append(t.files[n].name,t.files[n]);else return r["Image Upload"]=Snitzres.TypeNotAllowed,!1;if(t.files[n].size>Snitzres.MaxImageSize)return r["Image Upload"]=Snitzres.TooLarge,!1;if(t.files[n].name.length>255)return r["Image Upload"]=Snitzres.TooLong,!1}$("#galleryUploadForm").validate().showErrors(r)}return $("#galleryUploadForm").valid()&&(i=new XMLHttpRequest,i.open("POST",SnitzVars.baseUrl+"PhotoAlbum/Upload"),i.send(e),i.onreadystatechange=function(){var n,t,r;i.readyState===4&&i.status===200&&(n=i.responseText.split("|"),n[0].replace('"',"")==="Error"?alert(n[1]):(n[2].replace('"',"")=="true"&&(u="[cimage="),$("#editorDiv").length>0&&(t=$("#editorDiv"),r=t.find(".bbc-code-editor")[0].id,$("#"+r).insertAtCaret(u+n[1].replace('"',"")+f))),$("#modal-gallery-upload").modal("hide"))}),!1});$(document).on("change",":file",function(){var n=$(this),i=n.get(0).files?n.get(0).files.length:1,t=n.val().replace(/\\/g,"/").replace(/.*\//,"");$("#Image").val(t)});$("body").on("click",".gallery-link",function(n){n.preventDefault();$(this).tooltip("hide");$(this).attr("data-target","#modal-gallery-upload");$(this).attr("data-toggle","modal")});$("body").on("click",".modal-close-btn",function(){$("#modal-gallery-upload").modal("hide")});$("#modal-gallery-upload").on("hidden.bs.modal",function(){$(this).removeData("bs.modal")});$("#CancelModal").on("click",function(){return!1})});